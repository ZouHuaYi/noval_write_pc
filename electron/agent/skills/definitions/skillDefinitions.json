{
  "skills": [
    {
      "name": "load_story_context",
      "category": "context",
      "description": "加载当前小说的完整上下文信息（世界观、角色、剧情、伏笔）",
      "inputSchema": {
        "type": "object",
        "required": ["novelId"],
        "properties": {
          "novelId": {
            "type": "string",
            "description": "小说标识符（工作区路径）"
          },
          "include": {
            "type": "array",
            "items": {
              "enum": ["world", "characters", "plot", "foreshadows"]
            },
            "description": "需要包含的上下文类型",
            "default": ["world", "characters", "plot", "foreshadows"]
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "worldRules": {
            "type": "object",
            "description": "世界观规则"
          },
          "characters": {
            "type": "array",
            "description": "角色列表"
          },
          "plotState": {
            "type": "object",
            "description": "剧情状态"
          },
          "foreshadows": {
            "type": "array",
            "description": "伏笔列表"
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "scan_chapters",
      "category": "context",
      "description": "扫描章节文件，获取章节数量和最新章节号",
      "inputSchema": {
        "type": "object",
        "properties": {}
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "totalChapters": {
            "type": "number",
            "description": "总章节数"
          },
          "latestChapter": {
            "type": "number",
            "description": "最新章节号"
          },
          "chapterMapping": {
            "type": "object",
            "description": "章节文件映射"
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "plan_chapter",
      "category": "cognitive",
      "description": "规划章节（合并：分析前章、规划大纲、规划意图）",
      "inputSchema": {
        "type": "object",
        "required": ["worldRules", "characters"],
        "properties": {
          "targetChapter": {
            "type": "number",
            "description": "目标章节号"
          },
          "userRequest": {
            "type": "string",
            "description": "用户请求"
          },
          "worldRules": {
            "type": "object",
            "description": "世界观规则"
          },
          "characters": {
            "type": "array",
            "description": "角色列表"
          },
          "plotState": {
            "type": "object",
            "description": "剧情状态"
          },
          "recentCount": {
            "type": "number",
            "description": "分析最近N章",
            "default": 3
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "outline": {
            "type": "string",
            "description": "章节大纲（Markdown 格式）"
          },
          "chapterIntent": {
            "type": "object",
            "description": "章节写作意图（包含 goal, constraints, writing_guidelines）",
            "properties": {
              "goal": {
                "type": "string"
              },
              "constraints": {
                "type": "object"
              },
              "writing_guidelines": {
                "type": "object"
              }
            }
          },
          "previousAnalyses": {
            "type": "array",
            "description": "前章分析结果"
          },
          "scenes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                },
                "purpose": {
                  "type": "string"
                },
                "estimatedLength": {
                  "type": "number"
                }
              }
            }
          },
          "requiresUserConfirmation": {
            "type": "boolean",
            "description": "是否需要用户确认大纲",
            "default": true
          }
        }
      },
      "sideEffects": [],
      "requiresUserInteraction": true
    },
    {
      "name": "write_chapter",
      "category": "write",
      "description": "根据规划生成完整章节内容（合并：write_chapter, continue_chapter, expand_outline）",
      "inputSchema": {
        "type": "object",
        "required": ["outline", "chapterIntent"],
        "properties": {
          "outline": {
            "type": "string",
            "description": "章节大纲"
          },
          "chapterIntent": {
            "type": "object",
            "description": "章节写作意图"
          },
          "worldRules": {
            "type": "object",
            "description": "世界观规则"
          },
          "characters": {
            "type": "array",
            "description": "角色列表"
          },
          "plotState": {
            "type": "object",
            "description": "剧情状态"
          },
          "previousAnalyses": {
            "type": "array",
            "description": "前章分析结果"
          },
          "rewritePlan": {
            "type": "string",
            "description": "重写方案（可选，用于重写模式）"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "description": "生成的章节内容"
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "check_chapter",
      "category": "check",
      "description": "检查章节（合并：角色一致性、世界观规则、连贯性检查）",
      "inputSchema": {
        "type": "object",
        "required": ["content"],
        "properties": {
          "content": {
            "type": "string",
            "description": "待检查的章节内容"
          },
          "characters": {
            "type": "array",
            "description": "角色设定列表"
          },
          "worldRules": {
            "type": "object",
            "description": "世界观规则"
          },
          "previousAnalyses": {
            "type": "array",
            "description": "前章分析结果（用于连贯性检查）"
          },
          "context": {
            "type": "object",
            "description": "上下文信息"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "overallStatus": {
            "type": "string",
            "enum": ["pass", "fail", "warning"],
            "description": "整体状态"
          },
          "characterIssues": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "character": {
                  "type": "string"
                },
                "issue": {
                  "type": "string"
                },
                "severity": {
                  "type": "string",
                  "enum": ["low", "medium", "high", "critical"]
                }
              }
            }
          },
          "worldRuleIssues": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "coherenceIssues": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "summary": {
            "type": "string",
            "description": "检查结果摘要"
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "generate_rewrite_plan",
      "category": "cognitive",
      "description": "基于检查结果生成整改方案",
      "inputSchema": {
        "type": "object",
        "required": ["content", "checkResults"],
        "properties": {
          "content": {
            "type": "string",
            "description": "原始内容"
          },
          "checkResults": {
            "type": "object",
            "description": "检查结果"
          },
          "context": {
            "type": "object",
            "description": "上下文信息"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "rewritePlan": {
            "type": "string",
            "description": "整改方案（详细说明需要修改的地方和修改方式）"
          },
          "priority": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "优先级"
          },
          "estimatedChanges": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "section": {
                  "type": "string",
                  "description": "需要修改的段落"
                },
                "issue": {
                  "type": "string",
                  "description": "问题描述"
                },
                "suggestion": {
                  "type": "string",
                  "description": "修改建议"
                }
              }
            }
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "rewrite_chapter",
      "category": "write",
      "description": "根据整改方案重写章节（合并：rewrite_with_plan, rewrite_selected_text, polish_text）",
      "inputSchema": {
        "type": "object",
        "required": ["content", "rewritePlan"],
        "properties": {
          "content": {
            "type": "string",
            "description": "原始内容"
          },
          "rewritePlan": {
            "type": "string",
            "description": "整改方案"
          },
          "chapterIntent": {
            "type": "object",
            "description": "章节写作意图（可选）"
          },
          "context": {
            "type": "object",
            "description": "上下文信息"
          },
          "selectedText": {
            "type": "string",
            "description": "选中文本（可选，用于局部重写）"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "description": "重写后的内容"
          },
          "changes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "变更类型"
                },
                "description": {
                  "type": "string",
                  "description": "变更描述"
                }
              }
            }
          }
        }
      },
      "sideEffects": []
    },
    {
      "name": "finalize_chapter",
      "category": "action",
      "description": "整理章节，生成最终可发布版本",
      "inputSchema": {
        "type": "object",
        "required": ["content", "checkResults"],
        "properties": {
          "content": {
            "type": "string",
            "description": "章节内容"
          },
          "checkResults": {
            "type": "object",
            "description": "检查结果"
          },
          "chapterNumber": {
            "type": "number",
            "description": "章节号"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "finalContent": {
            "type": "string",
            "description": "最终内容"
          },
          "summary": {
            "type": "string",
            "description": "摘要"
          }
        }
      },
      "sideEffects": ["memory_update"]
    },
    {
      "name": "update_story_memory",
      "category": "action",
      "description": "更新故事记忆（合并：update_memory, sync_world, sync_character）",
      "inputSchema": {
        "type": "object",
        "required": ["content"],
        "properties": {
          "content": {
            "type": "string",
            "description": "章节内容（最终版本）"
          },
          "request": {
            "type": "object",
            "description": "用户请求"
          },
          "context": {
            "type": "object",
            "description": "上下文信息"
          },
          "replaceChapter": {
            "type": "number",
            "description": "需要替换的章节号（重写模式）"
          }
        }
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "更新是否成功"
          },
          "memoryUpdated": {
            "type": "boolean",
            "description": "记忆是否已更新（用于 Planner 规划）"
          },
          "updated": {
            "type": "object",
            "description": "更新结果（仅用于日志和调试，不影响 Planner 规划）",
            "properties": {
              "worldRules": {
                "type": "object"
              },
              "characters": {
                "type": "array"
              },
              "plotState": {
                "type": "object"
              }
            }
          }
        }
      },
      "sideEffects": ["memory_update"]
    }
  ]
}
